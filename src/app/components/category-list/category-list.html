<div class="category-list-container">
  <div class="header">
    <div class="header-left">
      <h3>Categories</h3>
      <div class="filter-group">
        <input
          type="text"
          [(ngModel)]="currentFilter.title"
          (ngModelChange)="applyFilters()"
          placeholder="Search categories..."
        />
      </div>
    </div>
    <button class="btn btn-primary" (click)="navigateToCreateCategory()">
      <span class="icon">+</span>
      New Category
    </button>
  </div>

  <!-- filter -->
  <div class="filters-card">
    <h5>Filters & Sorting</h5>
    <div class="sort-buttons-group">
      <div class="sort-buttons">
        <label>Sort by:</label>
        <button class="sort-btn" (click)="toggleSort('title')">
          Title
          <span class="sort-arrow">
            {{ currentSort.field === 'title' ? (currentSort.direction === 'asc'
            ? '↑' : '↓') : '' }}
          </span>
        </button>
        <button class="sort-btn" (click)="toggleSort('createdAt')">
          Created Date
          <span class="sort-arrow">
            {{ currentSort.field === 'createdAt' ? (currentSort.direction ===
            'asc' ? '↑' : '↓') : '' }}
          </span>
        </button>
      </div>
      <button class="btn btn-secondary" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>
  </div>
  <!-- category card -->
  <div
    class="categories-grid"
    *ngIf="filteredAndSortedCategories$ | async as result"
  >
    <div class="category-card" *ngFor="let category of result.categories">
      <div class="category-header">
        <div
          class="category-color"
          [style.background-color]="category.color"
        ></div>
        <h3>{{category.title}}</h3>
        <div class="category-actions">
          <button
            class="btn-icon"
            (click)="editCategory(category.id); $event.stopPropagation()"
          >
            ✏️
          </button>
          <button
            class="btn-icon delete"
            (click)="deleteCategory(category.id); $event.stopPropagation()"
          >
            🗑️
          </button>
        </div>
      </div>

      <p class="category-description">{{category.description}}</p>

      <div class="category-stats">
        <div class="stat">
          <span class="stat-number"
            >{{getCategoryTaskCount(category.id) | async}}</span
          >
          <span class="stat-label">Tasks</span>
        </div>
        <div class="stat">
          <span class="stat-date">{{formatDate(category.createdAt)}}</span>
          <span class="stat-label">Created</span>
        </div>
      </div>

      <!-- Category Tasks Preview -->
      <div
        class="category-tasks"
        *ngIf="getCategoryTasks(category.id) | async as tasks"
      >
        <h4 *ngIf="tasks.length >0">Recent Tasks</h4>
        <div class="task-preview" *ngFor="let task of tasks.slice(0, 3)">
          <span class="task-title">{{task.title}}</span>
          <span class="task-status" [class]="getStatusClass(task.status)"
            >{{task.status}}</span
          >
        </div>
        <div class="more-tasks" *ngIf="tasks.length > 3">
          +{{tasks.length - 3}} more tasks
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="result.categories.length === 0">
      <div class="empty-icon">📁</div>
      <h3>No categories found</h3>
      <p>Create your first category to organize your tasks better.</p>
      <button class="btn btn-primary" (click)="navigateToCreateCategory()">
        Create Category
      </button>
    </div>
  </div>
</div>
